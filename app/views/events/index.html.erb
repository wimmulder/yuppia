<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>



<% if user_signed_in? %>
      <%= current_user.name %><%= image_tag(current_user.image) %>
      <%= link_to "Log out", destroy_user_session_path, method: :delete %>
     <% else %>
       <p>
         <%= link_to "Sign in with Facebook", user_omniauth_authorize_path(:facebook) %>
         <%= link_to "Log in", new_user_session_path, class: "btn btn-default btn-lg" %>
         <%= link_to "Sign up", new_user_registration_path, class: "btn btn-primary btn-lg" %>
       </p>
  <% end %>

<h2>Evenementen</h2>

<% if user_signed_in? %>
  <%= link_to 'Nieuw evenement aanmaken', new_event_path, :class => "btn btn-primary" %>
<% end %>

<br /><br />

<table>
  <thead>
    <tr>
      <th>Titel</th>
      <th>Omschrijving</th>
      <th>Adres</th>
      <th>Datum</th>
      <th>Aangemaakt op</th>
      <th>Gebruiker</th>
      <th>Aantal deelnemers</th>
      <th colspan="2"></th>
    </tr>
  </thead>

  <tbody>
    <% @events.each do |event| %>
      <tr>
        <td><%= link_to event.event_id, event %></td>
        <td><%= event.description %></td>
        <td><%= event.address %></td>
        <td><%= event.date %></td>
        <td><%= event.created_at %></td>
        <td><%= link_to event.user.id, event.user %></td>
        <td><%= event.flaggings.length %></td>
        <td>
        <% if event.user == current_user %>
          <%= link_to 'Bewerken', edit_event_path(event) %>
          <%= link_to 'Verwijderen', event, method: :delete, data: { confirm: 'Are you sure?' } %>
        <% end %>




        <% if user_signed_in? %>
          <%= toggle_like_button(event, @current_user) %>
        <% end %>

        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<br />


<div id="map" style="width: 600px; height: 500px;"></div>


<script type="text/javascript">
  // Create the map
  var map = new google.maps.Map(document.getElementById("map"), {
    mapTypeId: google.maps.MapTypeId.ROADMAP
  });

  // Initialize the bounds container
  var bounds = new google.maps.LatLngBounds();

  <% @events.each do |event| %>
    // Create the LatLng
    var latLng = new google.maps.LatLng(<%= event.latitude %>, <%= event.longitude %>);

    // Create the marker
    var marker = new google.maps.Marker({
        position: latLng,
        map: map,
        title: '<%= escape_javascript(event.event_id) %>'
    });



    google.maps.event.addListener(marker, 'click', function() {
      document.location = '<%= event_path(event) %>';
    });

    // Extend the bounds
    bounds.extend(latLng);
  <% end %>

  // Fit to bounds
  map.fitBounds(bounds);
</script>
